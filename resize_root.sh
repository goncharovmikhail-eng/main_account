#!/bin/bash

set -e

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
VG_NAME="VG003"
LV_NAME="lv_root"
LV_PATH="/dev/${VG_NAME}/${LV_NAME}"

echo "üì¶ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ LVM-–¥–∏—Å–∫–∞: ${LV_PATH}"

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º—ã root
if [ "$(id -u)" -ne 0 ]; then
    echo "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç root"
    exit 1
fi

# 2. –ù–∞–π–¥—ë–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫ —Å LVM PV
PV_DEVICE=$(pvs --noheadings -o pv_name | head -n1 | awk '{$1=$1};1')
echo "üîç –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ LVM: $PV_DEVICE"

# 3. –†–∞—Å—à–∏—Ä—è–µ–º Physical Volume (–µ—Å–ª–∏ –¥–∏—Å–∫ —É–≤–µ–ª–∏—á–µ–Ω)
echo "üìè –†–∞—Å—à–∏—Ä—è–µ–º PV: $PV_DEVICE"
pvresize "$PV_DEVICE"

# 4. –†–∞—Å—à–∏—Ä—è–µ–º –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–º –Ω–∞ –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
echo "üîß –†–∞—Å—à–∏—Ä—è–µ–º LV –Ω–∞ –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ"
lvextend -l +100%FREE "$LV_PATH"

# 5. –†–∞—Å—à–∏—Ä—è–µ–º —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4
echo "üß∞ –†–∞—Å—à–∏—Ä—è–µ–º —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ext4"
resize2fs "$LV_PATH"

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:"
df -hT | grep "$LV_PATH"
